<section class="container page-content">
  <div class="search-form">
    <h2 class="page-title">ডোনার খুঁজুন</h2>
    <form action="/search" id="donor-search-form" class=" card">
      <div class="form-group">
        <label for="blood-group">রক্তের গ্রুপ:</label>
        <select id="blood-group" name="bloodGroup">
          <option value="">সব</option>
          <option value="A+" <%= filters.bloodGroup === 'A+' ? 'selected' : '' %>>A+</option>
          <option value="A-" <%= filters.bloodGroup === 'A-' ? 'selected' : '' %>>A-</option>
          <option value="B+" <%= filters.bloodGroup === 'B+' ? 'selected' : '' %>>B+</option>
          <option value="B-" <%= filters.bloodGroup === 'B-' ? 'selected' : '' %>>B-</option>
          <option value="O+" <%= filters.bloodGroup === 'O+' ? 'selected' : '' %>>O+</option>
          <option value="O-" <%= filters.bloodGroup === 'O-' ? 'selected' : '' %>>O-</option>
          <option value="AB+" <%= filters.bloodGroup === 'AB+' ? 'selected' : '' %>>AB+</option>
          <option value="AB-" <%= filters.bloodGroup === 'AB-' ? 'selected' : '' %>>AB-</option>
        </select>
      </div>
      <div class="form-group">
        <label for="address">জেলা/ঠিকানা:</label>
        <input
          type="text"
          id="address"
          name="address"
          placeholder="যেমন: ঢাকা, চট্টগ্রাম"
          value="<%= filters.address %>"
          class="form-control"
          max="10"
        />
      </div>
      <div class="form-actions">
        <button type="submit" class="button button-primary">
          অনুসন্ধান করুন
        </button>
        <button
          type="button"
          class="button button-secondary"
          id="reset-search-filters"
        >
          ফিল্টার রিসেট করুন
        </button>
      </div>
    </form>
  
  </div>
  <% if(donors.length > 0) { %>
    <section id="search-results" class="search-results-grid">
      <% donors.forEach(donor => { %>
        <a href="#" class="donor-card">
          <h4><%= donor.name %> <span class="ms-2 badge bg-danger"><%= donor.bloodGroup ?? 'N/A' %></span>
         <% 
            let available = 'Not Available';
            let badgeClass = 'bg-secondary'; // red by default
            if (donor.lastDonation) {
              const last = new Date(donor.lastDonation);
              const now = new Date();
              const diffMonths = (now.getFullYear() - last.getFullYear()) * 12 + (now.getMonth() - last.getMonth());
              if (diffMonths >= 4) {
                available = 'Available';
                badgeClass = 'bg-secondary'; // green
              }
            }
          %>

          <span class="ms-2 badge <%= badgeClass %>"><%= available %></span>
          
          </h4>
          <p>ঠিকানা: <%= donor.address %></p>
          <p>পূর্বে রক্ত দিয়েছেন: <%= donor.is_donated_before ? 'হ্যাঁ' : 'না' %></p>
          <p>মোবাইল: <span class="phone-link"><%= donor.phone %></span></p>
        </a>
      <% }) %>
    </section>
  <% } else { %>
    <div class="alert alert-info text-center">কোন ডোনার পাওয়া যায়নি।</div>
  <% } %>
    
 
</section>

<script>
  const resetBtn = document.getElementById('reset-search-filters');
  const form = document.getElementById('donor-search-form');

  resetBtn.addEventListener('click', () => {
    // সব input & select ফাঁকা করা
    form.querySelectorAll('input, select').forEach(el => {
      el.value = '';
      if(el.tagName === 'SELECT') el.selectedIndex = 0;
    });

    // Form submit করে fresh search page load করা
    form.submit();
  });
</script>

